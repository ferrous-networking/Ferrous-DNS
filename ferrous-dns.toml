# Ferrous DNS Advanced Configuration

[server]
dns_port = 53
web_port = 8080
bind_address = "0.0.0.0"
workers = 0

[dns]
# Upstream DNS servers
upstream_servers = [
    "8.8.8.8:53",
    "8.8.4.4:53",
    "1.1.1.1:53",
    "1.0.0.1:53",
]

query_timeout = 5
dnssec_enabled = true

# ============================================================================
# DNS CACHE CONFIGURATION
# ============================================================================

# Enable DNS caching
cache_enabled = true

# Cache TTL in seconds
cache_ttl = 1200

# Maximum cache entries
cache_max_entries = 200000

# ============================================================================
# EVICTION STRATEGY
# ============================================================================
# Choose one: "hit_rate", "lfu", "lfu-k"
#
# - "hit_rate": Evicts entries with lowest hits/second (best for changing patterns)
# - "lfu": Evicts entries with fewest total hits (best for stable patterns)  
# - "lfu-k": Evicts entries with lowest frequency in sliding window (balanced)
#
cache_eviction_strategy = "hit_rate"

# Minimum thresholds for eviction (strategy-specific)
cache_min_hit_rate = 2.0        # For hit_rate: minimum hits/second
cache_min_frequency = 10        # For lfu: minimum total hits
cache_min_lfuk_score = 1.5      # For lfu-k: minimum frequency score

# ============================================================================
# OPTIMISTIC REFRESH
# ============================================================================
# Proactively update popular entries before they expire

cache_optimistic_refresh = true

# Refresh when X% of TTL has elapsed (0.75 = 75%)
cache_refresh_threshold = 0.75

# ============================================================================
# LFU-K CONFIGURATION
# ============================================================================
# History size for LFU-K strategy (number of recent accesses to track)
cache_lfuk_history_size = 10

# ============================================================================
# PERFORMANCE OPTIMIZATIONS
# ============================================================================

# Batch eviction: Percentage of cache to evict when full (0.1 = 10%)
cache_batch_eviction_percentage = 0.1

# Lazy expiration: Check expiry only on access (recommended: true)
cache_lazy_expiration = true

# Background compaction interval in seconds (cleanup marked entries)
cache_compaction_interval = 300  # 5 minutes

# Adaptive thresholds: Auto-tune eviction thresholds based on effectiveness
cache_adaptive_thresholds = false

[blocking]
enabled = true
update_interval = 24

blocklist_urls = [
    "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts",
    "https://adaway.org/hosts.txt",
]

custom_blocked = []
whitelist = []

[logging]
level = "info"
format = "text"
file = "ferrous-dns.log"
rotate = true
max_size_mb = 100

[database]
path = "ferrous-dns.db"
log_queries = true
retention_days = 30
batch_interval = 5

# ============================================================================
# CACHE TUNING EXAMPLES
# ============================================================================

# Example 1: High-traffic server with changing patterns
# cache_eviction_strategy = "hit_rate"
# cache_max_entries = 500000
# cache_min_hit_rate = 5.0
# cache_batch_eviction_percentage = 0.15
# cache_adaptive_thresholds = true

# Example 2: Stable corporate DNS
# cache_eviction_strategy = "lfu"
# cache_max_entries = 100000
# cache_min_frequency = 50
# cache_batch_eviction_percentage = 0.05
# cache_adaptive_thresholds = false

# Example 3: Balanced hybrid (LFU-K)
# cache_eviction_strategy = "lfu-k"
# cache_max_entries = 200000
# cache_min_lfuk_score = 2.0
# cache_lfuk_history_size = 20
# cache_batch_eviction_percentage = 0.1
# cache_adaptive_thresholds = true

# Example 4: Low-memory server
# cache_enabled = true
# cache_max_entries = 50000
# cache_eviction_strategy = "hit_rate"
# cache_optimistic_refresh = false
# cache_batch_eviction_percentage = 0.2
